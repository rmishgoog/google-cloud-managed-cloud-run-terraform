### Provisioning a simple "hello" service on Google Cloud Run using Terraform

This repo contains a very basic Terraform configuration to provision a Cloud Run application on Google Cloud. We wil deploy a simple "hello" container image to Google Cloud Run and make it available publicly for consumption.

Before you begin, please make sure to do the following:

1. You have a Google Cloud project created or as a Project Owner, create a new project.
2. You have a Google account with Project Owner permissions (for real-life scenario, the best practice is to follow the principle of least privileges, however for the demo purposes here, we will just use an account with Project Owner primitive role assigned to it).
3. Login to the Google Cloud console using the account having Project Owner permissions and make sure you select the right project from the drop down menu.
4. Activate the Google Cloud shell using the icon at the right hand side of the browser window.

![image](https://user-images.githubusercontent.com/102101947/162500749-2bed73b5-61c4-4f5f-b9a8-27358e3896dd.png)


Once you are into Google Cloud shell terminal:

Run the command
```
gcloud auth list
```
Make sure that the active account is same as the one you logged in with.

Next, run the following command to make sure the default configurations are set correctly
```
gcloud config list
```
Here, you can verify if the project is the one you intend to use for provisioning the Cloud Run service. If not, you can always change it using
```
gcloud config set project <your-project-name>
```
Google provider for Terraform makes use of Application Default Credentials or ADC by default, you can also choose to configure a credentials file in JSON format instead having private keys of the service account you want Terraform to use OR once you have the key file, you can set GOOGLE_APPLICATION_CREDENTIALS environment variable with the value as the absolute path to the key file. Here, for convinience we will just use the ADC defaults.

To learn more about Google Cloud ADC, follow this [link](https://cloud.google.com/docs/authentication/production)

For Google Cloud client libraries to use ADC defaults, make sure that ADCs are up-to date and using right project, account and billing context, run the following command if you are running gcloud SDK locally and gcloud has access to a web-browser, follow along the instructions
```
gcloud auth application-default login
```
If your machine do not have access to a web browser, such as cloud shell instance, use this command instead and follow the instructions
```  
gcloud auth login --activate --no-launch-browser --quiet --update-adc
```  
Once, ADCs are updated, next clone the repo locally using the git CLI.

```
git clone https://github.com/rmishgoog/google-cloud-managed-cloud-run-terraform.git
```
Change to the root directory

```
cd google-cloud-managed-cloud-run-terraform
```
Here, create a file called terraform.tfvar and include your project and the Google Cloud region where the Cloud Run service will be deployed, optionally you can use variables on the command line while invoking terraform apply

```
project = "<your-project-name>"
region  = "<your-google-cloud-region"
```
Save the terraform.tfvars file.

Next run the terraform command to init the environment, this is when terraform will download the provider plugins etc.

```
terraform init
```
Then generate the terraform plan:

```
terraform plan
```
Lastly, apply the plan generated by terraform. If you do not want to be prompted, use the -auto-approve flag, if you do not use it, terraform will prompt for an approval before provisioning the resources, respond 'yes'.

```
terraform apply -auto-approve
```
Go to the Google Cloud console and click the 'hamburger' menu, under 'serverless' you shall find 'Cloud Run', click on it and you should see your Cloud Run service here, click on the service name and under details, you shall find a URL with a Google managed domain for your service, copy and past the URL into a browser and test your service.

Once done with all the testing, destroy the infrastructure you created.

```
terraform destroy -auto-approve
```

  
